<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" type="text/css" href="../css/font.css">
<link rel="stylesheet" type="text/css" href="../css/style.css">
<link rel="stylesheet" type="text/css" href="../css/jquery-ui.css">
<link rel="icon" href="../img/icon.png">
<title>Grille Cipher - Enigmator</title>
</head>

<script type="text/javascript" src="../js/jquery.min.js"></script>
<script type="text/javascript" src="../js/lib/grille.js"></script>
<script type="text/javascript" src="../js/enigmator.js"></script>
<script type="text/javascript" src="../js/main.js"></script>
<script type="text/javascript">
	method = Enigmator.grille;

	var ciphertext = $("#input-dec").val();
	var grille = [];

	execute = function(methodType){
		var input = $("#input-dec").val();
		if($("#btn-turning-dec").hasClass("active"))
			var str = methodType(input, grille, true);
		else
			var str = methodType(input, grille, false);
		$("#output").val(str);
	}

	function generateGrilleArr(size){
		grille = [];
		for(var i=0; i < size; i++){
			grille[i] = [];
			for(var j=0; j < size; j++){
				grille[i][j] = 0;
			}
		}
		console.log(grille);
	}

	function loadGrille(id, size, text){
		text = text || "";
		text = text.replace(/[\s+]/g, '');
		var index = 0;
		clearGrille(id, size);
		for(var i=0; i < size; i++){
			element = "<tr>";
			for(var j=0; j < size; j++){
				element += "<td id='"+id+"-"+i+"-"+j+"'>"+text.charAt(index)+"</td>";
				index++;
			}
			element += "</tr>";
			$(id).append(element);
		}
		
	}

	function clearGrille(id, size){
		if(id == "#grille-dec-b")
			generateGrilleArr(size);
		$(id).empty();
	}

	Array.prototype.move = function (old_index, new_index) {
    	if (new_index >= this.length) {
        	var k = new_index - this.length;
        	while ((k--) + 1) {
            	this.push(undefined);
        	}
    	}
    	this.splice(new_index, 0, this.splice(old_index, 1)[0]);
	};

	$(document).ready(function(){

		loadGrille("#grille-dec-a", 4, $("#input-dec").val());
		loadGrille("#grille-dec-b", 4);
		generateGrilleArr(4);

		$("#input-dec").bind("change keyup keydown", function(){
			var size = $("#grille-size-dec button span").text();
			size = size.charAt(0);
			loadGrille("#grille-dec-a", size, $(this).val());
		})

		$("#grille-size-dec .option li").click(function(){
			var size = $("#grille-size-dec button span").text();
			size = size.charAt(0);
			loadGrille("#grille-dec-a", size, $("#input-dec").val());
			loadGrille("#grille-dec-b", size);
			$("#input-dec").attr("maxlength",size*size);
			$("#input-dec").val(($("#input-dec").val().substr(0, size*size)));
			generateGrilleArr(size);
		})

		$(document).on("click", ".grille.btn td", function(){
			if(!$(this).hasClass("cut")){
				var idCount = $(this).attr("id").length;
				var r = Number($(this).attr("id").charAt(idCount-3));
				var c = Number($(this).attr("id").charAt(idCount-1));
				grille[r][c] = 1;

				$(this).addClass("cut");
			}
			else{
				var idCount = $(this).attr("id").length;
				var r = Number($(this).attr("id").charAt(idCount-3));
				var c = Number($(this).attr("id").charAt(idCount-1));
				grille[r][c] = 0;

				$(this).removeClass("cut");
			}
			//console.log(grille);
		})

		$("#btn-turning-dec").click(function(){
			if(!$(this).hasClass("active"))
			{
				$(this).addClass("active");
				$("#btn-rotate").show();
			}
			else
			{
				$(this).removeClass("active");
				$("#btn-rotate").hide();
			}
		})

		$("#btn-clear-dec").click(function(){
			var size = $("#grille-size-dec button span").text();
			size = size.charAt(0);

			$("#output").val("");
			$("#input-dec").val("");
			loadGrille("#grille-dec-a", size, $("#input-dec").val());
			loadGrille("#grille-dec-b", size);
			$(".grille.btn td").removeClass("cut");
		})

		$("#btn-rotate").click(function(){
			var output = $("#output").val();
			if(!output){
				return false;
			}
			var br = output.length / 4;
			var reg = new RegExp(".{1,"+br+"}","g");
			output = output.match(reg);
			output.move(3, 0);
			$("#output").val(output.join(""));
		})
	})
</script>

<style type="text/css">
	.grille {
		margin: 5px;
		border-collapse: collapse;
	}

	.grille tr td {
		padding: 5px;
		width: 30px;
		height: 30px;
		text-align: center;
		font-weight: bold;
		border: solid thin #434A54;
		background-color: #757575;
	}

	.grille tr td.cut {
		background-color: #fafafa;	
	}

	.grille.cipher {
		border: solid 2px #434A54;
		margin-right: 50px;
	}

	.grille.cipher tr td {
		background-color: #e0e0e0;
		border: none;
	}

	.grille.btn tr td {
		cursor: pointer;
	}

	.grille.btn tr td:hover {
		background-color: #e0e0e0;
	}
</style>
<body>
	<div class="header">
		<center><a href="../index.html"><img src="../img/title.png"></a></center>
	</div>

	<div class="menubar noselect">
	<div class="menu">
		<ul>
			<li id="btn-cipher" class="selected"><img src="../img/key.png"></li>
			<li id="btn-encoding"><img src="../img/encoder.png"></li>
			<li id="btn-hash"><img src="../img/hash.png"></li>
			<li id="btn-cryptanalysis"><img src="../img/text.png"></li>
			<li id="btn-about"><img src="../img/information.png"></li>
		</ul>
	</div>

	<div class="sub-menu">
		<h2 id="sub-menu-title">Cipher</h2>
		<ul id="menu-encoding" class="hide">
			<a href="../encoding/base64.html"><li>Base64</li></a>
			<a href="../encoding/base32.html"><li>Base32</li></a>
			<a href="../encoding/base16.html"><li>Base16</li></a>
			<div class="space"></div>
			<a href="../encoding/uuencoding.html"><li>UUencoding</li></a>
			<a href="../encoding/ascii85.html"><li>Ascii85</li></a>
		</ul>

		<ul id="menu-cipher">
			<a href="../cipher/rsa.html"><li>RSA</li></a>
			

			<div class="space"></div>
			<a href="../cipher/aes.html"><li>AES</li></a>
			<a href="../cipher/des.html"><li>DES</li></a>
			<a href="../cipher/tripledes.html"><li>TripleDES</li></a>
			<a href="../cipher/blowfish.html"><li>Blowfish</li></a>
			<a href="../cipher/xor.html"><li>XOR</li></a>

			<div class="hide">
			<a href="../cipher/rc4.html"><li>RC4</li></a>
			<a href="../cipher/rabbit.html"><li>Rabbit</li></a>
			</div>
			<a class="more" href="javascript:void();"><li>More <span>&#x25BC;</span></li></a>
			

			<div class="space"></div>
			<a href="../cipher/caesar_shift.html"><li>Caesar Shift</li></a>
			<a href="../cipher/vigenere.html"><li>Vigenere</li></a>
			<a href="../cipher/rot13.html"><li>ROT-13</li></a>

			<div>
			<a href="../cipher/affine.html"><li>Affine</li></a>
			<a href="../cipher/atbash.html"><li>Atbash</li></a>
			<a href="../cipher/autokey.html"><li>Autokey</li></a>
			<a href="../cipher/beaufort.html"><li>Beaufort</li></a>
			<a href="../cipher/bacon.html"><li>Bacon</li></a>
			<a href="../cipher/bifid.html"><li>Bifid</li></a>
			<a href="../cipher/trifid.html"><li>Trifid</li></a>
			<a href="../cipher/grille.html" class="selected"><li>Grille</li></a>
			<a href="../cipher/playfair.html"><li>Playfair</li></a>
			<a href="../cipher/railfence.html"><li>Railfence</li></a>
			<a href="../cipher/adfgvx.html"><li>ADFGVX</li></a>
			<a href="../cipher/morse_code.html"><li>Morse Code</li></a>
			<a href="../cipher/pigpen.html"><li>Pigpen</li></a>
			<a href="../cipher/dancing_men.html"><li>Dancing Men</li></a>
			<a href="../cipher/gold_bug.html"><li>Gold Bug</li></a>
			</div>
			<a class="more" href="javascript:void();"><li>Less <span>&#x25B2;</span></li></a>

			<div class="space"></div>
		</ul>

		<ul id="menu-hash" class="hide">
			<a href="../hash/md4.html"><li>MD4</li></a>
			<a href="../hash/md5.html"><li>MD5</li></a>
			<div class="space"></div>
			<a href="../hash/sha-1.html"><li>SHA-1</li></a>
			<a href="../hash/sha-256.html"><li>SHA-256</li></a>
			<a href="../hash/sha-512.html"><li>SHA-512</li></a>
			<a href="../hash/sha-3.html"><li>SHA-3</li></a>
			<div class="space"></div>
			<a href="../hash/ripemd-160.html"><li>RIPEMD-160</li></a>
			<div class="space"></div>
		</ul>

		<ul id="menu-cryptanalysis" class="hide">
			<a href="../cryptanalysis/crypto_identifier.html"><li>Crypto Identifier</li></a>
			<a href="../cryptanalysis/massive_decrypter.html"><li>Massive Decrypter</li></a>
			<div class="space"></div>
			<a href="../cryptanalysis/frequency_analysis.html"><li>Frequency Analysis</li></a>
			<a href="../cryptanalysis/cryptogram_solver.html"><li>Cryptogram Solver</li></a>
			<div class="space"></div>
			<a href="../cryptanalysis/string_converter.html"><li>String Converter</li></a>
			<a href="../cryptanalysis/string_manipulation.html"><li>String Manipulation</li></a>
			<div class="space"></div>
		</ul>

		<ul id="menu-about" class="hide">
			<a href="../about/index.html"><li>About</li></a>
			<a href="../about/license.html"><li>License</li></a>
			<a href="../about/download.html"><li>Download</li></a>
		</ul>

	</div>
	</div>

	<div class="content">
	<center><div class="main">
		<div class="title">
			<h2>Grille Cipher (Cardan Grille)</h2>
		</div>

		
			<h5>Cipher Text :</h5>
			<input id="input-dec" type="text" autofocus maxlength="16">
			<div class="clear"></div>
			<div id="grille-size-dec" class="select left">
			<button class="grey">Grille Size : <span>4 x 4</span></button>
			<ul class="option">
				<li>3 x 3</li>
				<li>4 x 4</li>
				<li>5 x 5</li>
				<li>6 x 6</li>
				<li>7 x 7</li>
				<li>8 x 8</li>
			</ul>
			</div>
			<div class="clear"></div>
			<div class="left">
				<h5>Preview :</h5>
				<table class="grille cipher" id="grille-dec-a"></table>
			</div>
			<div class="left">
				<h5>Grille :</h5>
				<table class="grille btn" id="grille-dec-b"></table>
			</div>
			<div class="clear"></div>
			<h6><i>Note : Click on Grille square you want to cut</i></h6>
			<button id="btn-dec" class="blue left">Decrypt</button>
			<button id="btn-turning-dec" class="grey left active">Use Rotation (Fleissner)</button>
			<div class="clear"></div>
			<h5>Output :</h5>
			<textarea id="output" readonly></textarea>
			<button id="btn-clear-dec" class="grey left large">Clear</button>
			<button id="btn-rotate" class="grey left">Rotate Order</button>
		
		
	</div></center>
	</div>
</body>
</html>